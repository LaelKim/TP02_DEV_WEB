<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TP02 WebAR — Exercice 6 (DOM overlay + marker events)</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
  <style>
    body{margin:0; overflow:hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial}
    .ui {
      position: fixed; inset: auto 12px 12px auto; /* bottom-right */
      display: none; /* Masqué par défaut, affiché quand markerFound */
      background: rgba(255,255,255,0.96);
      backdrop-filter: blur(4px);
      border-radius: 12px;
      box-shadow: 0 6px 24px rgba(0,0,0,.18);
      padding: 12px 14px;
      min-width: 220px;
      z-index: 9999; /* au-dessus du canvas A-Frame */
      pointer-events: auto;
    }
    .row { display:flex; gap:10px; align-items:center; margin:8px 0 }
    .row label { font-size: 14px; color:#111; min-width: 54px }
    .row input[type="range"]{ width: 160px }
    .chips { display:flex; gap:8px }
    .chip {
      width: 28px; height: 28px; border-radius: 999px; border: 2px solid rgba(0,0,0,.25);
      cursor: pointer; outline: none; background:#ddd
    }
    .chip:active { transform: scale(0.96) }
    .muted{ color:#555; font-size:12px; margin-top:4px }
    .banner { position: fixed; left: 12px; top: 12px; z-index: 9; background: rgba(17,17,17,.8); color:#fff; padding:6px 10px; border-radius:10px; font-size:12px }
  </style>
</head>
<body>

  <a-scene vr-mode-ui="enabled: false" embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    <a-marker preset="hiro" id="hiro" emitevents="true">
      <!--UI -->
      <a-box id="box" position="0 0.5 0" depth="1" height="1" width="1" color="#4CC3D9" opacity="0.85"
             animation__spin="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear">
      </a-box>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <!--Overlay -->
  <div id="ui" class="ui">
    <div style="font-weight:600; margin-bottom:6px">Contrôles de la boîte</div>
    <div class="row">
      <label for="size">Taille</label>
      <input id="size" type="range" min="0.1" max="3.0" step="0.1" value="1">
      <span id="sizeVal" class="muted">1.0</span>
    </div>
    <div class="row">
      <label>Couleur</label>
      <div class="chips">
        <button class="chip" data-color="#ef4444" style="background:#ef4444" aria-label="rouge"></button>
        <button class="chip" data-color="#22c55e" style="background:#22c55e" aria-label="vert"></button>
        <button class="chip" data-color="#3b82f6" style="background:#3b82f6" aria-label="bleu"></button>
      </div>
    </div>
  </div>

  <script>
    const ui = document.getElementById('ui');
    const slider = document.getElementById('size');
    const sizeVal = document.getElementById('sizeVal');
    const box = document.getElementById('box');
    const hiro = document.getElementById('hiro') || document.getElementById('hiroMarker');

    const showUI = () => { console.log('[AR] markerFound'); ui.style.display = 'block'; };
    const hideUI = () => { console.log('[AR] markerLost'); ui.style.display = 'none'; };

    if (hiro) {
      hiro.addEventListener('markerFound', showUI);
      hiro.addEventListener('markerLost', hideUI);
    } else {
      console.warn('Aucun marqueur avec id="hiro" ou "hiroMarker" trouvé. L\'UI sera affichée par défaut.');
      ui.style.display = 'block';
    }

    // Slide
    const setScale = (s) => {
      const v = Math.max(0.1, Math.min(3.0, Number(s)));
      box.setAttribute('scale', `${v} ${v} ${v}`);
      sizeVal.textContent = v.toFixed(1);
    };
    slider.addEventListener('input', (e) => setScale(e.target.value));

    // Palette
    document.querySelectorAll('.chip').forEach((btn) => {
      btn.addEventListener('click', () => {
        const c = btn.dataset.color;
        box.setAttribute('color', c);
        box.setAttribute('animation__pulse', {
          property: 'scale', dir: 'alternate', dur: 200, loop: 2, to: '1.15 1.15 1.15', easing: 'easeOutQuad'
        });
        setTimeout(() => box.removeAttribute('animation__pulse'), 450);
      });
    });
    setScale(slider.value);
  </script>
</body>
</html>
